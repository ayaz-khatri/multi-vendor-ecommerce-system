<!-- Breadcrumb Start -->
<div class="container-fluid">
    <div class="row px-xl-5">
        <div class="col-12">
            <nav class="breadcrumb bg-light mb-30">
                <a class="breadcrumb-item text-dark" href="/">Home</a>
                <a class="breadcrumb-item text-dark" href="/orders">Orders</a>
                <span class="breadcrumb-item active">Order Details</span>
            </nav>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->

<div class="container-fluid">
    <div class="row px-xl-5">

        <!-- LEFT: ORDER INFO -->
        <div class="col-lg-8 mb-4">
            <div class="bg-light p-30">

                <h4 class="mb-4">Order Summary</h4>

                <p><strong>Order Number:</strong> <%= order.orderNumber %></p>
                <p><strong>Order Date:</strong> <%= order.createdAt.toDateString() %></p>

                <p>
                    <strong>Status:</strong>
                    <% let badgeClass = 'secondary'; %>
                    <% if (order.orderStatus === 'pending') badgeClass = 'warning'; %>
                    <% if (order.orderStatus === 'confirmed') badgeClass = 'info'; %>
                    <% if (order.orderStatus === 'shipped') badgeClass = 'dark'; %>
                    <% if (order.orderStatus === 'delivered') badgeClass = 'success'; %>
                    <% if (order.orderStatus === 'cancelled') badgeClass = 'danger'; %>

                    <span class="badge badge-<%= badgeClass %> rounded-pill px-3 py-2  text-uppercase">
                        <%= order.orderStatus %>
                    </span>
                </p>

                <p>
                    <strong>Payment Method:</strong>
                    <%= order.paymentMethod === 'cod' ? 'Cash on Delivery' : 'Online Payment' %>
                </p>

                <p>
                    <strong>Payment Status:</strong>
                    <span class="badge rounded-pill px-3 py-2 text-uppercase badge-<%= order.paymentStatus === 'paid' ? 'success' : 'warning' %>">
                        <%= order.paymentStatus %>
                    </span>
                </p>

                <hr>

                <h5>Shipping Address</h5>
                <p class="mb-1"><%= order.shippingAddress.line1 %></p>
                <% if (order.shippingAddress.line2) { %>
                    <p class="mb-1"><%= order.shippingAddress.line2 %></p>
                <% } %>
                <p class="mb-1">
                    <%= order.shippingAddress.city %>,
                    <%= order.shippingAddress.state %>
                </p>
                <p class="mb-1">
                    <%= order.shippingAddress.country %> - <%= order.shippingAddress.postalCode %>
                </p>

            </div>
        </div>
        <!-- RIGHT: ITEMS -->
        <div class="col-lg-4">
            <div class="bg-light p-30">

                <h4 class="mb-4">Order Items</h4>

                <% order.items.forEach(item => { %>
                    <div class="d-flex justify-content-between">
                        <p><%= item.name %> × <%= item.quantity %></p>
                        <p>$<%= item.subtotal.toFixed(2) %></p>
                    </div>
                <% }) %>

                <hr>

                <div class="d-flex justify-content-between">
                    <strong>Total Items</strong>
                    <strong><%= order.totalQuantity %></strong>
                </div>

                <div class="d-flex justify-content-between mt-2">
                    <h5>Total</h5>
                    <h5>$<%= order.totalPrice.toFixed(2) %></h5>
                </div>

                <hr>
                <% if (order.orderStatus === 'pending') { %>
                    <button class="btn btn-danger btn-block" data-toggle="modal" data-target="#cancelOrderModal" type="button">Cancel Order</button>
                    <div class="modal fade" id="cancelOrderModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Confirm order cancellation?</h5>
                                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                                <div class="modal-body">Do you want to cancel this order?</div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
                                    <form action="/orders/cancel/<%= order._id %>" method="POST">
                                        <input class="btn btn-primary" type="submit" value="Yes, Cancel">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } %>

                <% if (order.orderStatus === 'shipped') { %>
                    <button class="btn btn-success btn-block" data-toggle="modal" data-target="#deliveryOrderModal" type="button">Confirm Delivery</button>
                    <div class="modal fade" id="deliveryOrderModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Confirm Delivery?</h5>
                                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                                <div class="modal-body">Do you want to confirm the delivery of this order?</div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
                                    <form action="/orders/confirm-delivery/<%= order._id %>" method="POST">
                                        <input class="btn btn-success" type="submit" value="Yes, Confirm Delivery">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } %>

                <a href="/orders" class="btn btn-outline-dark btn-block mt-2">
                    Back to Orders
                </a>

            </div>
        </div>

    </div>
</div>
