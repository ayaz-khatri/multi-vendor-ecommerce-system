<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800"><%= title %></h1>
        <div class="ml-auto">
          <a href="/vendor/orders" class="btn btn-outline-primary btn-sm mt-1">Orders</a>
        </div>
    </div>

</div>
<div class="container-fluid">
    <div class="row">

        <!-- LEFT: ORDER INFO -->
        <div class="col-lg-8 mb-4">
            <div class="bg-light p-3 shadow">


                <p><strong>Order Number:</strong> <%= order.orderId.orderNumber %></p>
                <p><strong>Order Date:</strong> <%= order.createdAt.toDateString() %></p>

                <!-- Vendor Status -->
                <p>
                    <strong>Vendor Status:</strong>
                    <% let badge = 'secondary'; %>
                    <% if (order.vendorStatus === 'pending') badge = 'warning'; %>
                    <% if (order.vendorStatus === 'accepted') badge = 'info'; %>
                    <% if (order.vendorStatus === 'shipped') badge = 'primary'; %>
                    <% if (order.vendorStatus === 'delivered') badge = 'success'; %>
                    <% if (order.vendorStatus === 'cancelled') badge = 'danger'; %>

                    <span class="badge badge-<%= badge %> text-uppercase px-3 py-2">
                        <%= order.vendorStatus %>
                    </span>
                </p>

                <p>
                    <strong>Payment Method:</strong>
                    <%= order.orderId.paymentMethod === 'cod'
                        ? 'Cash on Delivery'
                        : 'Online Payment'
                    %>
                </p>

                <hr>

                <!-- Update Vendor Status -->
                <% if (!['cancelled', 'delivered'].includes(order.vendorStatus)) { %>
                    <form action="/vendor/orders/status/<%= order._id %>" method="POST" class="mt-3">
                        <div class="form-group">
                            <label><strong>Update Order Status</strong></label>
                            <select name="vendorStatus" class="form-control" required>
                                <option value="">Select status</option>
                                <% if (order.vendorStatus === 'pending') { %>
                                    <option value="accepted">Accept Order</option>
                                <% } %>
                                <% if (['accepted'].includes(order.vendorStatus)) { %>
                                    <option value="shipped">Mark as Shipped</option>
                                <% } %>
                                <% if (order.vendorStatus === 'shipped') { %>
                                    <option value="delivered">Mark as Delivered</option>
                                <% } %>
                                <option value="cancelled">Cancel Order</option>
                            </select>
                        </div>
                        <button class="btn btn-primary mt-2">Update Status</button>
                    </form>
                <% } %>

            </div>
        </div>

        <!-- RIGHT: ITEMS BY SHOP -->
        <div class="col-lg-4">
            <div class="bg-light">

                <% itemsByShop.forEach(group => { %>

                    <div class="mb-3 p-3 shadow">
                        <h6 class="text-primary mb-2">
                            <i class="fas fa-store"></i>
                            <%= group.shop.name %>
                        </h6>

                        <% group.items.forEach(item => { %>
                            <div class="d-flex justify-content-between mb-1">
                                <span>
                                    <%= item.name %> Ã— <%= item.quantity %>
                                </span>
                                <span>
                                    $<%= item.subtotal.toFixed(2) %>
                                </span>
                            </div>
                        <% }) %>

                        <div class="d-flex justify-content-between mt-2 font-weight-bold">
                            <span>Shop Subtotal</span>
                            <span>$<%= group.subtotal.toFixed(2) %></span>
                        </div>
                    </div>

                <% }) %>
                
                <div class="p-3 mb-3 shadow">
                    <div class="d-flex justify-content-between">
                        <strong>Order Subtotal</strong>
                        <strong>$<%= order.subtotal.toFixed(2) %></strong>
                    </div>

                    <div class="d-flex justify-content-between mt-2">
                        <span>Commission</span>
                        <span>$<%= order.commission.toFixed(2) %></span>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-2 h5">
                    <strong>Your Earning</strong>
                    <small class="badge badge-<%= (order.vendorEarningStatus === 'paid' ? 'success' : 'danger') %>"><%= order.vendorEarningStatus %></small>
                    <strong class="text-success">
                        $<%= order.vendorEarning.toFixed(2) %>
                    </strong>
                </div>

            </div>
        </div>


    </div>
</div>
